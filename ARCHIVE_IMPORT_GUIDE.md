# Инструкция по импорту архивных данных

## Что было сделано

1. ✅ Создана таблица `archive_leads_analytics` для хранения исторических данных
2. ✅ Добавлен раздел "Архив" в админ-панель с 4 вкладками:
   - **График** - график контактов по дням с разбивкой по промоутерам
   - **Промоутеры** - рейтинг промоутеров по количеству контактов
   - **Организации** - статистика по организациям
   - **Импорт** - инструмент для импорта данных

3. ✅ Созданы backend функции:
   - `archive-import` - импорт CSV данных
   - `archive-stats` - получение статистики

## Как импортировать данные

### Способ 1: Через админ-панель (рекомендуется)

1. Откройте админ-панель
2. Перейдите на вкладку **"Архив"**
3. Откройте вкладку **"Импорт"**
4. Скопируйте данные из Excel/Google Sheets (все строки с данными)
5. Вставьте в текстовое поле
6. Нажмите **"Импортировать данные"**

**Формат данных (разделитель - табуляция):**
```
15.03.2025 18:09:53	Кид Форс Выхино	Вероника	3
18.03.2025 22:19:14	ШИЯ Солнцево	Арсен	15
22.03.2025 21:06:18	Воркаут Царицыно	Наталия	4
```

### Способ 2: Через консоль браузера

1. Откройте админ-панель
2. Нажмите F12 (открыть консоль)
3. Вставьте CSV данные в переменную:

```javascript
const csvData = `15.03.2025 18:09:53	Кид Форс Выхино	Вероника	3
18.03.2025 22:19:14	ШИЯ Солнцево	Арсен	15
22.03.2025 21:06:18	Воркаут Царицыно	Наталия	4`;

const sessionToken = localStorage.getItem('session_token');

fetch('https://functions.poehali.dev/94c5eb5a-9182-4dc0-82f0-b4ddbb44acaf', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'X-Admin-Token': sessionToken
  },
  body: JSON.stringify({
    data: csvData.split('\n').map(line => {
      const parts = line.split('\t');
      return {
        datetime: parts[0],
        organization: parts[1],
        user: parts[2],
        count: parts[3]
      };
    })
  })
})
.then(r => r.json())
.then(result => console.log('✅ Импортировано:', result.imported));
```

## Что делает импорт

1. Парсит CSV данные (дата + время, организация, промоутер, количество контактов)
2. Находит организацию и пользователя в базе по имени
3. Создаёт записи в таблице `archive_leads_analytics`
4. Возвращает количество импортированных записей и список ошибок

## Важно

⚠️ **Перед импортом убедитесь:**
- Все организации существуют в базе (должны быть добавлены ранее)
- Все пользователи существуют в базе (должны быть зарегистрированы)
- Формат даты: `ДД.ММ.ГГГГ ЧЧ:ММ:СС` (московское время)
- Разделитель между полями - табуляция (автоматически при копировании из Excel)

## Проверка импорта

После импорта:
1. Откройте вкладку **"График"** - должен отобразиться график с данными
2. Откройте вкладку **"Промоутеры"** - должен показать рейтинг
3. Откройте вкладку **"Организации"** - должна быть статистика

## Примечания

- Данные импортируются в отдельную таблицу `archive_leads_analytics`
- Текущие данные (leads_analytics) остаются без изменений
- Можно импортировать данные частями (например, по месяцам)
- Дубликаты не проверяются - будьте внимательны при повторном импорте
